《嵌入式 Linux 设备驱动》

课程专题报告

号：55140624

名：王坤

院：软件学院

业：软件工程

期：2016－2017（2）

一

40

二

30

三

30

总分

100

学

姓

学

专

学

题号

满分

得分

1

一题满分

得分

40

一、阐述题（每小题 5 分，共 40 分）
1．Linux 设备驱动的概念及意义？

概念：系统调用是操作系统内核与应用程序之间的接口，设备驱动程序则是操作系统内

核与机器硬件的接口。几乎所有的系统操作最终映射到物理设备，除了 CPU、内存和少数其

它设备，所有的设备控制操作都由该设备特殊的可执行代码实现，此代码就是设备驱动程序。

设备驱动作为操作系统和硬件设备间的粘合剂，相当于一个中间人，负责双方的沟通。驱动

负责将操作系统的请求传输转化为特定物理设备控制器能够理解的命令。

意义：为 Linux 系统内核提供调用接口；控制硬件，因为寄存器是控制硬件的操作，所

以驱动程序控制硬件，也就是通过读写硬件寄存器达到控制硬件的目的。

2．你是如何理解 Linux 设备驱动的健壮性和安全性？

由于

驱动是内核的一部分：驱动已经成为内核中最庞大的组成部分，内核会直接以函数调用

的方式调用驱动代码，驱动的动态安装和卸载都会“更改”内核。

驱动对内核的影响：驱动程序崩溃甚至会导致内核崩溃；驱动的效率会影响内核的整体

效率；驱动的漏洞会造成内核安全漏洞。

常见驱动安全性问题：未初始化指针；恶意用户程序；缓冲区溢出；竞争状态。

所以驱动的健壮性与安全性问题值得关注。

3．Linux 提供给应用程序调用的驱动程序接口有哪些？

操作系统内核需要访问两类主要设备:字符设备和块设备。与此相关主要有两类设备驱动

程序，字符设备驱动程序和块设备驱动程序。Linux（也是所有 UNIX）的基本原理之一是：

系统试图使它对所有各类设备的输入、输出看起来就好象对普通文件的输入、输出一样。设

备驱动程序本身具有文件的外部特征，它们都能使用像 open（），close（），read（），

write（）等系统调用。为使设备的存取能象文件一样处理，所有设备在目录中应有对应的文

2

件名称，才可使用有关系统调用。

通常 Linux 驱动程序接口分为如下四层：

1).应用程序进程与内核的接口；

2).内核与文件系统的接口；

3).文件系统与设备驱动程序的接口；

4).设备驱动程序与硬件设备的接口。

4．内核空间和用户空间的概念及两者的区别？

Linux 简化了分段机制，使得虚拟地址与线性地址总是一致，因此，Linux 的虚拟地
址空间也为 0～4G。Linux 内核将这 4G 字节的空间分为两部分。将最高的 1G 字节（从
虚拟地址 0xC0000000 到 0xFFFFFFFF），供内核使用，称为“内核空间”。而将较低的
3G 字节（从虚拟地址 0x00000000 到 0xBFFFFFFF），供各个进程使用，称为“用户空间）。
因为每个进程可以通过系统调用进入内核，因此，Linux 内核由系统内的所有进程共享。
于是，从具体进程的角度来看，每个进程可以拥有 4G 字节的虚拟空间。

Linux 使用两级保护机制：0 级供内核使用，3 级供用户程序使用。每个进程有各自
的私有用户空间（0～3G），这个空间对系统中的其他进程是不可见的。最高的 1GB 字

节虚拟内核空间则为所有进程以及内核所共享。

内核空间中存放的是内核代码和数据，而进程的用户空间中存放的是用户程序（应

用程序）的代码和数据。不管是内核空间还是用户空间，它们都处于虚拟空间中。虽然

内核空间占据了每个虚拟空间中的最高 1GB 字节，但映射到物理内存却总是从最低地址
（0x00000000）开始。对内核空间来说，其地址映射是很简单的线性映射，0xC0000000
就是物理地址与线性地址之间的位移量，在 Linux 代码中就叫做 PAGE_OFFSET。

5．以石英晶体为例简述压电效应产生的原理。

石英晶体在沿一定的的方向受到外力的作用变形时，由于内部电极化现象同时在两个

表面上产生符号相反的电荷，当外力去掉恢复到不带电的状态；当作用力方向改变时，电

荷的极性随着改变。晶体受力所产生的电荷量与外力大小成正比。这种现象称为正压电效

3

应。反之，如对石英晶体施加一定变电场，晶体本身将产生机械变形，外电场撤离，变形

也随之消失，称为逆压电效应。石英晶体整个晶体是中性的，受外力作用而变形时，没有

体积变形压电效应，但它具有良好的厚度变形和长度变形压电效应。

6．金属应变片与半导体应变片在工作原理上有何不同？

金属应变片是通过变形改变丝栅的几何尺寸，而它的电阻率一般不变，半导体应变片

是基于压阻效应而工作的，就是说沿半导体晶轴的应变，使它的电阻率有很大的变化，从

而产生电阻变化，这是他们的不同。

7．比较自感式传感器与差动变压器式传感器的异同？

不同点：1）自感式传感器把被测非电量的变化转换成自感系数的变化。

2）差动变压器式传感器吧被测非电量的变化转换成互感系数的变化。

相同点：两者都属于电感式传感器，都可以分为气隙型，气隙截面型和螺管型。

8．为什么电容式传感器易受干扰？如何减小干扰？

(1) 温度的影响：

对结构尺寸影响：使部分零件几何尺寸发生变化，产生附加电容。故在制造时，一般

选用温度系数小、几何尺寸稳定的材料。

(2) 漏电阻的影响：

一般的绝缘电阻将被看作是对电容式传感器的一个旁路，被称为漏电阻，与传感器容抗接

近时，将是系统总的灵敏度下降。因此应选取绝缘性能好的材料做两极板间支架。采用高的

激励电源频率。

(3) 边缘效应：

极板的边缘附近电场分布不均匀，从而使电容的计算十分复杂，产生误差。因此，首先

应增大电容器的初始电容量，此外，还可以装等位环。

(4) 寄生参数的影响：

可以缩短传感器到测量线路前置级的距离，或用驱动电缆法和整体屏蔽法

4

二题满分

得分

30

二、嵌入式系统分析（每小题 15 分，共 30 分）
1．什么是物性型传感器？什么是结构型传感器？（分别各举出 2 种传感器的例子说明）

物性型传感器，就是利用某些功能材料本身所具有的内在特性及效应感受(敏感)被测量，

并转换成可用电信号的传感器。

例如利用具有压电特性的石英晶体材料制成的压电式传感器，就是利用石英晶体材料本

身具有的正压电效应而实现对压力测量的。还有热敏电阻传感器、光电式传感器等。

结构型传感器，是以结构(如形状、尺寸等)为基础，利用某些物理规律来感受(敏感)被测

量，并将其转换为电信号实现测量的。

例如电容式压力传感器，必须有按规定参数设计制成的电容式敏感元件，当被测压力作

用在电容式敏感元件的动极板上时，引起电容间隙的变化导致电容值的变化，从而实现对压

力的测量。又比如谐振式压力传感器 ，必须设计制作一个合适的感受被测压力的谐振敏感元

件，当被测压力变化时，改变谐振敏感结构的等效刚度，导致谐振敏感元件的固有频率发生

变化，从而实现对压力的测量。

2．结合常见的嵌入式产品，举出一个 MTD 设备驱动程序的例子，以“图示和文字”相结合

的形式分析其框架及实现过程？

MTD(memory technology device 内存技术设备)是用于访问 memory 设备（ROM、flash）

的 Linux 的子系统。MTD 的主要目的是为了使新的 memory 设备的驱动更加简单，为此它在硬

件和上层之间提供了一个抽象的接口。MTD 的所有源代码在/drivers/mtd 子目录下。CFI 接

口的 MTD 设备分为四层（从设备节点直到底层硬件驱动），这四层从上到下依次是：设备节

点、MTD 设备层、MTD 原始设备层和硬件驱动层。结构图如下所示：

5

Flash 硬件驱动层，该层的基于特定处理器、特定 flash 芯片和结构体来实现硬件驱

动。

MTD 原始设备层：用类型 mtd_info 的结构体来描述 MTD 原始设备，该结构体中有一

个域会指向 Flash 硬件驱动层中所有使用的结构体。

MTD 块设备层：该层也叫 flash 翻译层(FTL)。以前为了在 MTD 设备上使用某种传统

的文件系统，Linux 系统中存在一个叫做 flash 翻译层(FTL)，该 FTL 是在 MTD 原始设备

的基础上模拟出块设备，所以 FTL 以下的所有内容呈现给上层的就是一个块设备。这样

可以使用通用的块设备的接口了。

通用磁盘层：再上层就是通用磁盘层了，其实每个分区在最后都是向通用磁盘层注

册成了一个 disk 来使用。

6

三题满分

得分

30

三、嵌入式系统设计（共 30 分）

根据对本课程的理解，充分发挥你的想象力和创造力，想象并设计一个未来手机的某个

新功能，要求如下：

（1） 明确指出你所设计未来手机的新功能是什么。

防摔喷气防护:在手机从高处落下时，在手机四角处喷出气体进行缓冲，时其以稳

定的水平状态落地，减少冲击损伤配合外壳甚至达到无伤。

7

《嵌入式 Linux 设备驱动》

（2） 描述其具体用到的嵌入式传感器是什么？工作原理是什么？

课程专题报告

距离传感器：原理：“飞行时间法”（flying time）是通过发射特别短的并测量此光脉冲

号：55140624

从发射到被物体反射回来的时间，通过测时间间隔来计算与物体之间的距离。

名：王坤

红传统的距离传感器采用外 LED 灯发射红外线，被近距离物体反射后，红外探测器通过
接收到红外线的强度，测定距离，一般有效距离在 10cm 内。距离传感器同时拥有发射和接

院：软件学院

受装置，一般体积较大。此处使用的应区别于传统的，感应距离更长的传感器，这样此系统

业：软件工程

的防护意义更大，理想上能够应对的摔落距离越大越好。

期：2016－2017（2）

激光速度传感器：原理：随着现今精密制造业的崛起和节省成本的需求，非接触测速传

一

感器会慢慢取接触式测速传感器。而现在市场上精度较高、最常用的非接触激光测速传感器

40

就是 ZLS-Px 像差测速传感器。像差测速传感器有两个端口：一个发射端口，发出 LED 光源；
一个是高速拍照端口，实现 CCD 面积高速成像对比，通过在极短时间内的两个时间的图像对

二

比，分辨被测物体移动的距离，结合传感器内部的算法，实时输出被测物体的速度。如图所

30

示，①LED 光发射口，②摄像接收口，③、④接线端，⑤固定螺孔 。①LED 光发射口对着被

三

测物发射出激光，经反射到②摄像接收口，接收到信号后传给信号处理器，通过算法计算出

30

它的速度。

总分

重力传感器：原理：利用压电效应实现，传感器内部一块重物和压电片整合在一起，通

100

过正交两个方向产生的电压大小，来计算出水平方向。

学

（3） 画出其各个功能的关系框图（并在图下面进行文字说明及解释）。

姓

8

学

专

学

题号

满分

得分

1

（速度传感器<----->距离传感器<---->重力传感器）--->CO2 气罐和气压喷嘴---->手机芯片

速度传感器计算手机下落的速度，距离传感器测出离地面的距离，当速度达到一定峰值

并且离地面距离达到一定短的时候，这两者的关系需要通过实验进行计算来确定喷射气体的

最佳时机。

重力传感器通过分析手机偏离水平的角度来决定四个角方向上喷出气体的量和方向，来

进一步调节手机落地时的形态。

一题满分

得分

CO2 气罐和气压喷嘴需要连接嵌入式芯片并且足够灵敏，Co2 气罐可以重复补充。

40

9

一、阐述题（每小题 5 分，共 40 分）
1．Linux 设备驱动的概念及意义？

概念：系统调用是操作系统内核与应用程序之间的接口，设备驱动程序则是操作系统内

核与机器硬件的接口。几乎所有的系统操作最终映射到物理设备，除了 CPU、内存和少数其

它设备，所有的设备控制操作都由该设备特殊的可执行代码实现，此代码就是设备驱动程序。

设备驱动作为操作系统和硬件设备间的粘合剂，相当于一个中间人，负责双方的沟通。驱动

负责将操作系统的请求传输转化为特定物理设备控制器能够理解的命令。

意义：为 Linux 系统内核提供调用接口；控制硬件，因为寄存器是控制硬件的操作，所

以驱动程序控制硬件，也就是通过读写硬件寄存器达到控制硬件的目的。

2．你是如何理解 Linux 设备驱动的健壮性和安全性？

由于

驱动是内核的一部分：驱动已经成为内核中最庞大的组成部分，内核会直接以函数调用

的方式调用驱动代码，驱动的动态安装和卸载都会“更改”内核。

驱动对内核的影响：驱动程序崩溃甚至会导致内核崩溃；驱动的效率会影响内核的整体

效率；驱动的漏洞会造成内核安全漏洞。

常见驱动安全性问题：未初始化指针；恶意用户程序；缓冲区溢出；竞争状态。

所以驱动的健壮性与安全性问题值得关注。

3．Linux 提供给应用程序调用的驱动程序接口有哪些？

操作系统内核需要访问两类主要设备:字符设备和块设备。与此相关主要有两类设备驱动

程序，字符设备驱动程序和块设备驱动程序。Linux（也是所有 UNIX）的基本原理之一是：

系统试图使它对所有各类设备的输入、输出看起来就好象对普通文件的输入、输出一样。设

备驱动程序本身具有文件的外部特征，它们都能使用像 open（），close（），read（），

write（）等系统调用。为使设备的存取能象文件一样处理，所有设备在目录中应有对应的文

2

件名称，才可使用有关系统调用。

通常 Linux 驱动程序接口分为如下四层：

1).应用程序进程与内核的接口；

2).内核与文件系统的接口；

3).文件系统与设备驱动程序的接口；

4).设备驱动程序与硬件设备的接口。

4．内核空间和用户空间的概念及两者的区别？

Linux 简化了分段机制，使得虚拟地址与线性地址总是一致，因此，Linux 的虚拟地
址空间也为 0～4G。Linux 内核将这 4G 字节的空间分为两部分。将最高的 1G 字节（从
虚拟地址 0xC0000000 到 0xFFFFFFFF），供内核使用，称为“内核空间”。而将较低的
3G 字节（从虚拟地址 0x00000000 到 0xBFFFFFFF），供各个进程使用，称为“用户空间）。
因为每个进程可以通过系统调用进入内核，因此，Linux 内核由系统内的所有进程共享。
于是，从具体进程的角度来看，每个进程可以拥有 4G 字节的虚拟空间。

Linux 使用两级保护机制：0 级供内核使用，3 级供用户程序使用。每个进程有各自
的私有用户空间（0～3G），这个空间对系统中的其他进程是不可见的。最高的 1GB 字

节虚拟内核空间则为所有进程以及内核所共享。

内核空间中存放的是内核代码和数据，而进程的用户空间中存放的是用户程序（应

用程序）的代码和数据。不管是内核空间还是用户空间，它们都处于虚拟空间中。虽然

内核空间占据了每个虚拟空间中的最高 1GB 字节，但映射到物理内存却总是从最低地址
（0x00000000）开始。对内核空间来说，其地址映射是很简单的线性映射，0xC0000000
就是物理地址与线性地址之间的位移量，在 Linux 代码中就叫做 PAGE_OFFSET。

5．以石英晶体为例简述压电效应产生的原理。

石英晶体在沿一定的的方向受到外力的作用变形时，由于内部电极化现象同时在两个

表面上产生符号相反的电荷，当外力去掉恢复到不带电的状态；当作用力方向改变时，电

荷的极性随着改变。晶体受力所产生的电荷量与外力大小成正比。这种现象称为正压电效

3

应。反之，如对石英晶体施加一定变电场，晶体本身将产生机械变形，外电场撤离，变形

也随之消失，称为逆压电效应。石英晶体整个晶体是中性的，受外力作用而变形时，没有

体积变形压电效应，但它具有良好的厚度变形和长度变形压电效应。

6．金属应变片与半导体应变片在工作原理上有何不同？

金属应变片是通过变形改变丝栅的几何尺寸，而它的电阻率一般不变，半导体应变片

是基于压阻效应而工作的，就是说沿半导体晶轴的应变，使它的电阻率有很大的变化，从

而产生电阻变化，这是他们的不同。

7．比较自感式传感器与差动变压器式传感器的异同？

不同点：1）自感式传感器把被测非电量的变化转换成自感系数的变化。

2）差动变压器式传感器吧被测非电量的变化转换成互感系数的变化。

相同点：两者都属于电感式传感器，都可以分为气隙型，气隙截面型和螺管型。

8．为什么电容式传感器易受干扰？如何减小干扰？

(1) 温度的影响：

对结构尺寸影响：使部分零件几何尺寸发生变化，产生附加电容。故在制造时，一般

选用温度系数小、几何尺寸稳定的材料。

(2) 漏电阻的影响：

一般的绝缘电阻将被看作是对电容式传感器的一个旁路，被称为漏电阻，与传感器容抗接

近时，将是系统总的灵敏度下降。因此应选取绝缘性能好的材料做两极板间支架。采用高的

激励电源频率。

(3) 边缘效应：

极板的边缘附近电场分布不均匀，从而使电容的计算十分复杂，产生误差。因此，首先

应增大电容器的初始电容量，此外，还可以装等位环。

(4) 寄生参数的影响：

可以缩短传感器到测量线路前置级的距离，或用驱动电缆法和整体屏蔽法

4

二题满分

得分

30

二、嵌入式系统分析（每小题 15 分，共 30 分）
1．什么是物性型传感器？什么是结构型传感器？（分别各举出 2 种传感器的例子说明）

物性型传感器，就是利用某些功能材料本身所具有的内在特性及效应感受(敏感)被测量，

并转换成可用电信号的传感器。

例如利用具有压电特性的石英晶体材料制成的压电式传感器，就是利用石英晶体材料本

身具有的正压电效应而实现对压力测量的。还有热敏电阻传感器、光电式传感器等。

结构型传感器，是以结构(如形状、尺寸等)为基础，利用某些物理规律来感受(敏感)被测

量，并将其转换为电信号实现测量的。

例如电容式压力传感器，必须有按规定参数设计制成的电容式敏感元件，当被测压力作

用在电容式敏感元件的动极板上时，引起电容间隙的变化导致电容值的变化，从而实现对压

力的测量。又比如谐振式压力传感器 ，必须设计制作一个合适的感受被测压力的谐振敏感元

件，当被测压力变化时，改变谐振敏感结构的等效刚度，导致谐振敏感元件的固有频率发生

变化，从而实现对压力的测量。

2．结合常见的嵌入式产品，举出一个 MTD 设备驱动程序的例子，以“图示和文字”相结合

的形式分析其框架及实现过程？

MTD(memory technology device 内存技术设备)是用于访问 memory 设备（ROM、flash）

的 Linux 的子系统。MTD 的主要目的是为了使新的 memory 设备的驱动更加简单，为此它在硬

件和上层之间提供了一个抽象的接口。MTD 的所有源代码在/drivers/mtd 子目录下。CFI 接

口的 MTD 设备分为四层（从设备节点直到底层硬件驱动），这四层从上到下依次是：设备节

点、MTD 设备层、MTD 原始设备层和硬件驱动层。结构图如下所示：

5

Flash 硬件驱动层，该层的基于特定处理器、特定 flash 芯片和结构体来实现硬件驱

动。

MTD 原始设备层：用类型 mtd_info 的结构体来描述 MTD 原始设备，该结构体中有一

个域会指向 Flash 硬件驱动层中所有使用的结构体。

MTD 块设备层：该层也叫 flash 翻译层(FTL)。以前为了在 MTD 设备上使用某种传统

的文件系统，Linux 系统中存在一个叫做 flash 翻译层(FTL)，该 FTL 是在 MTD 原始设备

的基础上模拟出块设备，所以 FTL 以下的所有内容呈现给上层的就是一个块设备。这样

可以使用通用的块设备的接口了。

通用磁盘层：再上层就是通用磁盘层了，其实每个分区在最后都是向通用磁盘层注

册成了一个 disk 来使用。

6

三题满分

得分

30

三、嵌入式系统设计（共 30 分）

根据对本课程的理解，充分发挥你的想象力和创造力，想象并设计一个未来手机的某个

新功能，要求如下：

（1） 明确指出你所设计未来手机的新功能是什么。

防摔喷气防护:在手机从高处落下时，在手机四角处喷出气体进行缓冲，时其以稳

定的水平状态落地，减少冲击损伤配合外壳甚至达到无伤。

7

（2） 描述其具体用到的嵌入式传感器是什么？工作原理是什么？

距离传感器：原理：“飞行时间法”（flying time）是通过发射特别短的并测量此光脉冲

从发射到被物体反射回来的时间，通过测时间间隔来计算与物体之间的距离。

红传统的距离传感器采用外 LED 灯发射红外线，被近距离物体反射后，红外探测器通过
接收到红外线的强度，测定距离，一般有效距离在 10cm 内。距离传感器同时拥有发射和接

受装置，一般体积较大。此处使用的应区别于传统的，感应距离更长的传感器，这样此系统

的防护意义更大，理想上能够应对的摔落距离越大越好。

激光速度传感器：原理：随着现今精密制造业的崛起和节省成本的需求，非接触测速传

感器会慢慢取接触式测速传感器。而现在市场上精度较高、最常用的非接触激光测速传感器

就是 ZLS-Px 像差测速传感器。像差测速传感器有两个端口：一个发射端口，发出 LED 光源；
一个是高速拍照端口，实现 CCD 面积高速成像对比，通过在极短时间内的两个时间的图像对

比，分辨被测物体移动的距离，结合传感器内部的算法，实时输出被测物体的速度。如图所

示，①LED 光发射口，②摄像接收口，③、④接线端，⑤固定螺孔 。①LED 光发射口对着被

测物发射出激光，经反射到②摄像接收口，接收到信号后传给信号处理器，通过算法计算出

它的速度。

重力传感器：原理：利用压电效应实现，传感器内部一块重物和压电片整合在一起，通

过正交两个方向产生的电压大小，来计算出水平方向。

（3） 画出其各个功能的关系框图（并在图下面进行文字说明及解释）。

8

（速度传感器<----->距离传感器<---->重力传感器）--->CO2 气罐和气压喷嘴---->手机芯片

速度传感器计算手机下落的速度，距离传感器测出离地面的距离，当速度达到一定峰值

并且离地面距离达到一定短的时候，这两者的关系需要通过实验进行计算来确定喷射气体的

最佳时机。

重力传感器通过分析手机偏离水平的角度来决定四个角方向上喷出气体的量和方向，来

进一步调节手机落地时的形态。

CO2 气罐和气压喷嘴需要连接嵌入式芯片并且足够灵敏，Co2 气罐可以重复补充。

9

